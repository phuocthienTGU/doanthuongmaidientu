<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Li√™n h·ªá - Jollibee Clone</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Arial", sans-serif;
      }
      body {
        background-color: #f5f5f5;
        color: #333;
      }
      header {
        background: #d6001c;
        padding: 15px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
      }
      header .logo {
        font-size: 28px;
        font-weight: bold;
      }
      header nav a {
        color: white;
        margin-left: 25px;
        text-decoration: none;
        font-size: 18px;
      }
      .contact-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
      }
      .contact-header {
        text-align: center;
        margin-bottom: 40px;
      }
      .contact-header h1 {
        color: #d6001c;
        font-size: 36px;
        margin-bottom: 10px;
      }
      .contact-header p {
        color: #666;
        font-size: 18px;
      }
      .contact-sections {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
        margin-bottom: 50px;
      }
      .contact-section {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .contact-section h2 {
        color: #d6001c;
        font-size: 24px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
      }
      .contact-info {
        font-size: 16px;
        line-height: 1.6;
      }
      .contact-info p {
        margin-bottom: 10px;
      }
      .contact-info strong {
        color: #d6001c;
      }
      .action-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      .action-btn {
        background: #d6001c;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 20px;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
      .action-btn:hover {
        background: #b30015;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(214, 0, 28, 0.2);
      }
      .action-btn i {
        font-size: 32px;
        margin-bottom: 10px;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        position: relative;
      }
      .close-btn {
        position: absolute;
        right: 20px;
        top: 15px;
        font-size: 28px;
        cursor: pointer;
        color: #999;
      }
      .close-btn:hover {
        color: #d6001c;
      }
      .modal h3 {
        color: #d6001c;
        margin-bottom: 20px;
        font-size: 24px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
      }
      .form-group textarea {
        min-height: 120px;
        resize: vertical;
      }
      .submit-btn {
        background: #d6001c;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        transition: background 0.3s;
      }
      .submit-btn:hover {
        background: #b30015;
      }
      .chat-container {
        height: 400px;
        display: flex;
        flex-direction: column;
      }
      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 5px;
        margin-bottom: 15px;
      }
      .message {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 5px;
        max-width: 80%;
        word-wrap: break-word;
      }
      .user-message {
        background: #d6001c;
        color: white;
        margin-left: auto;
      }
      .admin-message {
        background: #e9e9e9;
        color: #333;
        margin-right: auto;
      }
      .chat-input {
        display: flex;
        gap: 10px;
      }
      .chat-input input {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .send-btn {
        background: #d6001c;
        color: white;
        border: none;
        padding: 0 20px;
        border-radius: 5px;
        cursor: pointer;
      }
      .call-info {
        text-align: center;
        padding: 30px 0;
      }
      .call-number {
        font-size: 36px;
        color: #d6001c;
        font-weight: bold;
        margin: 20px 0;
      }
      .call-btn {
        background: #4caf50;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 5px;
        font-size: 18px;
        cursor: pointer;
        margin-top: 20px;
        text-decoration: none;
        display: inline-block;
      }
      .call-btn:hover {
        background: #45a049;
      }
      footer {
        margin-top: 40px;
        padding: 20px;
        background: #d6001c;
        color: white;
        text-align: center;
      }
      @media (max-width: 768px) {
        header {
          padding: 15px 20px;
          flex-direction: column;
          gap: 15px;
        }
        header nav {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px;
        }
        .action-buttons {
          grid-template-columns: 1fr;
        }
        .contact-section {
          padding: 20px;
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <script src="img-config.js"></script>
    <!-- HEADER -->
    <header>
      <div class="logo">Jollibee Clone</div>
      <nav>
        <a href="index.html">Trang ch·ªß</a>
        <a href="thucdon.html">Th·ª±c ƒë∆°n</a>
        <a href="#">Khuy·∫øn m√£i</a>
        <a href="lienhe.html">Li√™n h·ªá</a>
        <a href="theodoi.html">Theo d√µi ƒë∆°n h√†ng</a>
        <a
          id="cart-btn"
          href="giohang.html"
          style="
            background: yellow;
            padding: 6px 12px;
            border-radius: 6px;
            color: black !important;
            font-weight: bold;
            margin-left: 15px;
          "
        >
          üõí Gi·ªè h√†ng (<span id="cart-count">0</span>)
        </a>
        <span id="user-area" style="margin-left: 20px; font-size: 18px"></span>
      </nav>
    </header>

    <div class="contact-container">
      <div class="contact-header">
        <h1>Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h1>
        <p>Ch√∫ng t√¥i lu√¥n s·∫µn s√†ng h·ªó tr·ª£ b·∫°n m·ªçi l√∫c, m·ªçi n∆°i</p>
      </div>

      <div class="contact-sections">
        <section class="contact-section">
          <h2><i class="fas fa-building"></i> Tr·ª• s·ªü ch√≠nh</h2>
          <div class="contact-info">
            <p>
              <strong>ƒê·ªãa ch·ªâ:</strong> T·∫ßng 26, T√≤a nh√† Cl√≠ Tower, s·ªë 152 ƒêi·ªán
              Bi√™n Ph√∫, Ph∆∞·ªùng 25, Qu·∫≠n B√¨nh Th·∫°nh, TP.HCM
            </p>
            <p><strong>ƒêi·ªán tho·∫°i:</strong> (028) 39309168</p>
            <p><strong>Email:</strong> info@jollibeeclone.com</p>
            <p>
              <strong>Gi·ªù l√†m vi·ªác:</strong> 8:00 - 20:00 (Th·ª© 2 - Ch·ªß nh·∫≠t)
            </p>
          </div>
        </section>

        <section class="contact-section">
          <h2><i class="fas fa-headset"></i> ChƒÉm s√≥c kh√°ch h√†ng</h2>
          <p style="margin-bottom: 20px">
            Ch√∫ng t√¥i lu√¥n l·∫Øng nghe v√† h·ªó tr·ª£ b·∫°n. H√£y l·ª±a ch·ªçn h√¨nh th·ª©c li√™n
            h·ªá ph√π h·ª£p:
          </p>
          <div class="action-buttons">
            <button class="action-btn" id="feedback-btn">
              <i class="fas fa-comment-dots"></i> G√≥p √Ω
            </button>
            <button class="action-btn" id="chat-btn">
              <i class="fas fa-comments"></i> Chat ngay
            </button>
            <button class="action-btn" id="call-btn">
              <i class="fas fa-phone-alt"></i> G·ªçi t·ªïng ƒë√†i
            </button>
          </div>
        </section>
      </div>
    </div>

    <!-- MODALS -->
    <!-- G√ìP √ù -->
    <div id="feedback-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('feedback-modal')"
          >&times;</span
        >
        <h3><i class="fas fa-comment-dots"></i> G·ª≠i g√≥p √Ω</h3>
        <form id="feedback-form">
          <div class="form-group">
            <label>H·ªç v√† t√™n *</label>
            <input type="text" id="feedback-name" required />
          </div>
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i *</label>
            <input type="tel" id="feedback-phone" required />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="feedback-email" />
          </div>
          <div class="form-group">
            <label>Lo·∫°i g√≥p √Ω *</label>
            <select id="feedback-type" required>
              <option value="">Ch·ªçn lo·∫°i g√≥p √Ω</option>
              <option value="chat_luong_dich_vu">Ch·∫•t l∆∞·ª£ng d·ªãch v·ª•</option>
              <option value="chat_luong_mon_an">Ch·∫•t l∆∞·ª£ng m√≥n ƒÉn</option>
              <option value="giao_hang">Giao h√†ng</option>
              <option value="nhan_vien">Nh√¢n vi√™n</option>
              <option value="khac">Kh√°c</option>
            </select>
          </div>
          <div class="form-group">
            <label>N·ªôi dung g√≥p √Ω *</label>
            <textarea id="feedback-content" required></textarea>
          </div>
          <button type="submit" class="submit-btn">G·ª≠i g√≥p √Ω</button>
        </form>
      </div>
    </div>

    <!-- CHAT -->
    <div id="chat-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('chat-modal')"
          >&times;</span
        >
        <h3><i class="fas fa-comments"></i> Chat v·ªõi h·ªó tr·ª£</h3>
        <div class="chat-container">
          <div class="chat-messages" id="chat-messages"></div>
          <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." />
            <button class="send-btn" id="send-btn">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- CALL -->
    <div id="call-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('call-modal')"
          >&times;</span
        >
        <h3><i class="fas fa-phone-alt"></i> G·ªçi t·ªïng ƒë√†i</h3>
        <div class="call-info">
          <p>Li√™n h·ªá qua t·ªïng ƒë√†i mi·ªÖn ph√≠:</p>
          <div class="call-number">1900 1234</div>
          <p>Th·ªùi gian: 8:00 - 20:00 h√†ng ng√†y</p>
          <a href="tel:19001234" class="call-btn"
            ><i class="fas fa-phone"></i> G·ªçi ngay</a
          >
        </div>
      </div>
    </div>

    <footer>¬© 2025 Jollibee Clone</footer>

    <script>
      const currentUser = JSON.parse(localStorage.getItem("user"));

      function loadUser() {
        const userArea = document.getElementById("user-area");
        if (!currentUser || !currentUser.hoTen) {
          userArea.innerHTML = `<a href="login.html" style="color: yellow;">ƒêƒÉng nh·∫≠p</a>`;
          return;
        }
        userArea.innerHTML = `
          Xin ch√†o, <b>${currentUser.hoTen}</b> |
          <a href="#" onclick="logout()" style="color: yellow;">ƒêƒÉng xu·∫•t</a>
        `;
      }

      function logout() {
        localStorage.removeItem("user");
        localStorage.removeItem("token");
        localStorage.removeItem("vaitro");
        alert("ƒê√£ ƒëƒÉng xu·∫•t!");
        location.reload();
      }

      function openModal(id) {
        document.getElementById(id).style.display = "block";
      }

      function closeModal(id) {
        document.getElementById(id).style.display = "none";
      }

      document.getElementById("feedback-btn").onclick = () => {
        openModal("feedback-modal");
        if (currentUser && currentUser.hoTen) {
          document.getElementById("feedback-name").value =
            currentUser.hoTen || "";
          document.getElementById("feedback-phone").value =
            currentUser.DienThoai || "";
          document.getElementById("feedback-email").value =
            currentUser.Email || "";
        }
      };

      document.getElementById("chat-btn").onclick = () => {
        openModal("chat-modal");
        loadChatHistory();
      };

      document.getElementById("call-btn").onclick = () =>
        openModal("call-modal");

      window.onclick = (e) => {
        if (e.target.classList.contains("modal")) {
          closeModal(e.target.id);
        }
      };

      document.getElementById("feedback-form").onsubmit = async (e) => {
        e.preventDefault();

        const data = {
          MaUser: currentUser ? currentUser.maNguoiDung : null,
          HoTen: document.getElementById("feedback-name").value.trim(),
          DienThoai: document.getElementById("feedback-phone").value.trim(),
          Email: document.getElementById("feedback-email").value.trim() || null,
          LoaiGopY: document.getElementById("feedback-type").value,
          NoiDung: document.getElementById("feedback-content").value.trim(),
        };

        if (!data.HoTen || !data.DienThoai || !data.LoaiGopY || !data.NoiDung) {
          alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!");
          return;
        }

        try {
          const res = await fetch(window.API_BASE + "/api/feedback/send", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          const result = await res.json();
          alert(result.message || "G·ª≠i g√≥p √Ω th√†nh c√¥ng!");
          document.getElementById("feedback-form").reset();
          closeModal("feedback-modal");
        } catch (err) {
          console.error("L·ªói g·ª≠i g√≥p √Ω:", err);
          alert("L·ªói g·ª≠i g√≥p √Ω, vui l√≤ng th·ª≠ l·∫°i");
        }
      };

      // ===== CHAT RI√äNG CHO T·ª™NG USER =====
      const chatMessages = document.getElementById("chat-messages");
      const chatInput = document.getElementById("chat-input");
      const sendBtn = document.getElementById("send-btn");

      async function loadChatHistory() {
        chatMessages.innerHTML =
          "<div class='message admin-message'>ƒêang t·∫£i...</div>";
        try {
          const maUser =
            currentUser && currentUser.maNguoiDung
              ? currentUser.maNguoiDung
              : "guest";
          const res = await fetch(
            `${window.API_BASE}/api/chat/history/${maUser}`
          );
          const messages = await res.json();

          chatMessages.innerHTML = "";
          if (messages.length === 0) {
            chatMessages.innerHTML =
              "<div class='message admin-message'>Xin ch√†o! Ch√∫ng t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</div>";
          }

          messages.forEach((msg) => {
            const div = document.createElement("div");
            div.className = `message ${
              msg.LaTuUser ? "user-message" : "admin-message"
            }`;
            div.innerHTML = `<strong>${msg.HoTen}:</strong> ${
              msg.TinNhan
            }<br><small>${new Date(msg.ThoiGian).toLocaleString(
              "vi-VN"
            )}</small>`;
            chatMessages.appendChild(div);
          });

          chatMessages.scrollTop = chatMessages.scrollHeight;
        } catch (err) {
          console.error("L·ªói t·∫£i chat:", err);
          chatMessages.innerHTML =
            "<div class='message admin-message'>L·ªói t·∫£i l·ªãch s·ª≠ chat</div>";
        }
      }

      async function sendMessage() {
        const text = chatInput.value.trim();
        if (!text) return;

        sendBtn.disabled = true;

        const HoTen =
          currentUser && currentUser.hoTen
            ? currentUser.hoTen
            : "Kh√°ch v√£ng lai";
        const MaUser =
          currentUser && currentUser.maNguoiDung
            ? currentUser.maNguoiDung
            : null;

        console.log("G·ª≠i chat v·ªõi:", { MaUser, HoTen, TinNhan: text }); // Debug

        try {
          const response = await fetch(window.API_BASE + "/api/chat/send", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ MaUser, HoTen, TinNhan: text }),
          });

          if (!response.ok) {
            throw new Error("L·ªói server khi g·ª≠i tin");
          }

          chatInput.value = "";
          loadChatHistory();
        } catch (err) {
          console.error("L·ªói g·ª≠i tin nh·∫Øn:", err);
          alert("L·ªói g·ª≠i tin nh·∫Øn, vui l√≤ng th·ª≠ l·∫°i");
        } finally {
          sendBtn.disabled = false;
        }
      }

      sendBtn.onclick = sendMessage;
      chatInput.onkeypress = (e) => {
        if (e.key === "Enter") sendMessage();
      };

      // T·ª± ƒë·ªông reload chat m·ªói 5 gi√¢y khi modal m·ªü
      let chatInterval;
      const chatModal = document.getElementById("chat-modal");
      chatModal.addEventListener("transitionend", () => {
        if (chatModal.style.display === "block") {
          chatInterval = setInterval(loadChatHistory, 5000);
        } else {
          clearInterval(chatInterval);
        }
      });

      // C·∫≠p nh·∫≠t gi·ªè h√†ng
      async function updateCartCount() {
        if (!currentUser || !currentUser.maNguoiDung) {
          document.getElementById("cart-count").innerText = "0";
          return;
        }
        try {
          const res = await fetch(
            `${window.API_BASE}/api/giohang/user/${currentUser.maNguoiDung}`
          );
          if (!res.ok) throw new Error();
          const data = await res.json();
          const total = data.chiTiet.reduce((s, i) => s + i.SoLuong, 0);
          document.getElementById("cart-count").innerText = total;
        } catch {
          document.getElementById("cart-count").innerText = "0";
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadUser();
        updateCartCount();
      });
    </script>
  </body>
</html>
